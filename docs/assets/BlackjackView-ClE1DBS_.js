var T=Object.defineProperty;var w=(n,t,e)=>t in n?T(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var d=(n,t,e)=>w(n,typeof t!="symbol"?t+"":t,e);import{D as x,d as g,c as f,a as r,b as i,F as m,r as D,n as C,e as I,f as P,t as _,g as k,o as s,h as p,_ as F,i as v,j as $,u as W,k as A}from"./index-CK8mLERG.js";class G{constructor(t){d(this,"players");d(this,"playerMap",{});d(this,"deck");this.players=t.players,this.deck=t.deck,this.players.forEach(e=>{if(this.playerMap[e.id])throw new Error(`Duplicate player id: ${e.id}`);this.playerMap[e.id]=e})}getPlayer(t){return this.playerMap[t]}}class b extends G{constructor(e){if(e.players.filter(c=>c.isDealer).length!==1)throw new Error("There must be exactly one dealer");e.players=e.players.sort((c,u)=>c.isDealer?1:-1);super(e);d(this,"title","Blackjack");d(this,"activePlayerIdx",0);d(this,"dealerFinalScore",null);d(this,"gameStatus","over")}startGame(){this.deck=new x,this.deck.shuffle(),this.dealerFinalScore=null,this.players.forEach(e=>{e.cards=[]});for(let e=0;e<2;e++)this.players.forEach(c=>{c.cards.push(this.deck.dealCard())});this.activePlayerIdx=0,this.gameStatus="inProgress"}getDealer(){return this.players.find(e=>e.isDealer)}getPlayers(){return this.players.filter(e=>!e.isDealer)}getActivePlayer(){return this.players[this.activePlayerIdx]}getPlayerScore(e){return[...e.cards].sort((u,o)=>u.isAce?1:-1).reduce((u,o)=>{let l=0;return o.rank==="A"?u+11>21?l=1:l=11:["K","Q","J"].includes(o.rank)?l=10:l=parseInt(o.rank),u+l},0)}playerHit(e){e.cards.push(this.deck.dealCard()),this.postHit(e)}postHit(e){this.getPlayerScore(e)>=21&&(this.activePlayerIdx=this.activePlayerIdx+1,this.checkIfDealerTurn())}playerStay(e){this.activePlayerIdx=this.activePlayerIdx+1,this.checkIfDealerTurn()}checkIfDealerTurn(){this.getActivePlayer()===this.getDealer()&&this.dealerTurn()}dealerTurn(){const e=this.getDealer();for(;this.getPlayerScore(e)<17;)e.cards.push(this.deck.dealCard());this.dealerFinalScore=this.getPlayerScore(e),this.gameStatus="over"}isPlayerWinner(e){return this.dealerFinalScore===null?!1:this.dealerFinalScore>21||this.dealerFinalScore<this.getPlayerScore(e)}isDealerWinner(){return this.dealerFinalScore===null?!1:this.getPlayers().every(e=>this.getPlayerScore(e)>21||(this.dealerFinalScore??0)>=this.getPlayerScore(e))}isPlayerBusted(e){return this.getPlayerScore(e)>21}isPlayersTurn(e){return e===this.getActivePlayer()}isPlayerBlackjack(e){return this.getPlayerScore(e)===21&&e.cards.length===2}isPlayerPush(e){return e.isDealer?!1:this.getPlayerScore(e)===this.dealerFinalScore}}const E={key:0,class:"flex flex-col items-center"},H={class:"m-0 mt-1"},j=g({__name:"BlackjackHand",props:{cards:{}},setup(n){const t=n,e=f(()=>[...t.cards].sort((l,a)=>l.isAce?1:-1).reduce((l,a)=>{let y=0;return a.rank==="A"?l+11>21?y=1:y=11:["K","Q","J"].includes(a.rank)?y=10:y=parseInt(a.rank),l+y},0)),c=f(()=>e.value>21),u=f(()=>`${t.cards.length*5.5}rem`);return(o,l)=>o.cards.length?(s(),r("div",E,[i("div",{class:"flex content-center",style:C({maxWidth:u.value})},[(s(!0),r(m,null,D(o.cards,(a,y)=>(s(),r("div",{key:a.id,class:P(["overflow-hidden",{"overflow-visible":y===o.cards.length-1}])},[p(F,{card:a,class:"w-36"},null,8,["card"])],2))),128))],4),i("p",H,[I(" Total: "),i("span",{class:P({"text-red-500":c.value})},_(e.value),3)])])):k("",!0)}}),M={class:"flex flex-col justify-center items-center"},N={key:0,class:"dealer"},V={class:"text-center"},L={key:0,class:"mt-4 flex flex-col items-center"},z={key:0,class:"text-error"},J={key:1,class:"text-success"},K={key:1,class:"divider"},Q={class:"players flex justify-between"},Y=["player"],q={class:"mt-4 flex flex-col items-center"},O={key:0,class:"text-error"},R={key:1,class:"text-primary"},U=i("div",{class:"text-success"},"Winner!",-1),X={key:0,class:"text-accent"},Z=i("div",{class:"text-primary mb-4"},"Your turn",-1),ee={class:"flex justify-center join join-horizontal"},te=["onClick"],ae=["onClick"],se={class:"text-center"},re=g({__name:"BlackjackGame",props:{blackjack:{}},setup(n){const t=n,e=f(()=>{if(t.blackjack.getDealer().cards.length)return t.blackjack.getDealer()}),c=f(()=>t.blackjack.getPlayers().filter(a=>a.cards.length));function u(){console.log("Game started"),t.blackjack.startGame()}function o(a){t.blackjack.playerHit(a)}function l(a){t.blackjack.playerStay(a)}return(a,y)=>(s(),r(m,null,[i("section",M,[e.value?(s(),r("div",N,[i("h3",V,_(e.value.name),1),p(j,{cards:e.value.cards},null,8,["cards"]),a.blackjack.isPlayersTurn(e.value)?(s(),r("div",L,[a.blackjack.isPlayerBusted(e.value)?(s(),r("div",z,"Dealer Busted!")):a.blackjack.isDealerWinner()?(s(),r("div",J,"Dealer Wins!")):k("",!0)])):k("",!0)])):k("",!0),e.value?(s(),r("hr",K)):k("",!0),i("div",Q,[(s(!0),r(m,null,D(c.value,h=>(s(),r("div",{key:h.name,player:h},[p(j,{cards:h.cards},null,8,["cards"]),i("div",q,[a.blackjack.isPlayerBusted(h)?(s(),r("div",O,"Busted!")):a.blackjack.isPlayerPush(h)?(s(),r("div",R,"Push")):a.blackjack.isPlayerWinner(h)?(s(),r(m,{key:2},[U,a.blackjack.isPlayerBlackjack(h)?(s(),r("div",X,"Blackjack!")):k("",!0)],64)):a.blackjack.isPlayersTurn(h)?(s(),r(m,{key:3},[Z,i("div",ee,[i("button",{type:"button",class:"join-item btn btn-primary",onClick:B=>o(h)}," Hit ",8,te),i("button",{type:"button",class:"join-item btn btn-outline text-primary",onClick:B=>l(h)}," Stay ",8,ae)])],64)):k("",!0)]),i("h3",se,_(h.name),1)],8,Y))),128))])]),i("div",{class:"flex items-center justify-center my-8"},[i("button",{type:"button",class:"btn btn-accent",onClick:u},"Start New Game")])],64))}});class S{constructor(t){d(this,"playerType","player");d(this,"name","");d(this,"cards",[]);d(this,"id","");this.name=t.name,this.id=t.name,this.playerType=t.playerType,this.cards=t.cards}get isDealer(){return this.playerType==="dealer"}}const le={key:0},ne=g({__name:"BlackjackView",setup(n){const t=v(),e=v([new S({name:"Brian",playerType:"player",cards:[]})]),c=v("init"),u=f(()=>c.value==="loading"),o=f(()=>c.value==="loaded"),l=v();return $(()=>{c.value="loading",setTimeout(()=>{t.value="Blackjack",l.value=new b({players:e.value.concat(new S({name:"Dealer",playerType:"dealer",cards:[]})),deck:new x}),c.value="loaded"},500)}),(a,y)=>u.value?(s(),r("div",le,"Loading...")):o.value?(s(),r(m,{key:1},[l.value instanceof W(b)?(s(),A(re,{key:0,blackjack:l.value},null,8,["blackjack"])):k("",!0)],64)):k("",!0)}});export{ne as default};
