var F=Object.defineProperty;var R=(n,e,t)=>e in n?F(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var v=(n,e,t)=>R(n,typeof e!="symbol"?e+"":e,t);import{d as V,r as S,D as T,c as f,a as P,o as r,b as i,e as o,F as b,f as N,n as $,g as D,_ as W,h as H,i as L,t as C,j as k,s as Y,u as c,k as z,l as A}from"./index-CAIuKXGD.js";class O{constructor(e){v(this,"playerType","player");v(this,"name","");v(this,"cards",[]);v(this,"id","");this.name=e.name,this.id=e.name,this.playerType=e.playerType??"player",this.cards=e.cards??[]}get isDealer(){return this.playerType==="dealer"}}class I extends O{constructor(){super(...arguments);v(this,"finalScore",0);v(this,"currentScore",0);v(this,"hasBlackjack",!1);v(this,"isBusted",!1)}playerReset(){this.cards=[],this.finalScore=0,this.currentScore=0,this.hasBlackjack=!1,this.isBusted=!1}calculateCurrentState(){this.currentScore=this.getPlayerScore(),this.isBusted=this.currentScore>21,this.hasBlackjack=this.cards.length===2&&this.currentScore===21,(this.isBusted||this.hasBlackjack)&&(this.finalScore=this.currentScore)}addCard(t){this.cards.push(t),this.calculateCurrentState(),(this.isBusted||this.hasBlackjack)&&this.stand()}stand(){this.cards.forEach(t=>t.setFaceUp()),this.calculateCurrentState(),this.finalScore=this.currentScore}getPlayerScore(){return[...this.cards].sort((a,u)=>a.isAce?1:-1).reduce((a,u)=>{let h=0;return u.rank==="A"?a+11>21?h=1:h=11:["K","Q","J"].includes(u.rank)?h=10:h=parseInt(u.rank),a+h},0)}}class U extends I{constructor(){super({name:"Dealer",playerType:"dealer",cards:[]})}}const J=V("blackjack",()=>{const n=S(new U),e=S([new I({name:"Brian"})]),t=S(-1),a=S(new T),u=f(()=>t.value>e.value.length-1),h=f(()=>t.value>-1?e.value[t.value]:void 0),d=S("init"),B=f(()=>d.value==="over"),w=f(()=>d.value==="inProgress"),x=f(()=>d.value==="init");function m(){t.value=-1,d.value="inProgress",a.value=new T,a.value.shuffle(),n.value.playerReset(),e.value.forEach(s=>s.playerReset());for(let s=0;s<2;s++){e.value.forEach(E=>E.addCard(a.value.dealCard()));const g=a.value.dealCard();s===0&&g.setFaceDown(),n.value.addCard(g)}_(),n.value.hasBlackjack&&(e.value.forEach(s=>y(s)),p())}function _(){var s,g;t.value++,u.value?p():((s=h.value)!=null&&s.hasBlackjack||(g=h.value)!=null&&g.isBusted)&&_()}function l(s){s.addCard(a.value.dealCard()),(s.isBusted||s.hasBlackjack)&&y(s)}function y(s){s.stand(),_()}function j(s){s.addCard(a.value.dealCard()),y(s)}function p(){for(console.log("dealer turn"),n.value.cards.forEach(s=>s.setFaceUp()),n.value.calculateCurrentState();n.value.currentScore<17;)n.value.addCard(a.value.dealCard());n.value.stand(),d.value="over"}return{dealer:n,players:e,activePlayerIndex:t,deck:a,isDealersTurn:u,isGameOver:B,isGameInProgress:w,isGameInit:x,startGame:m,playerHit:l,playerStand:y,playerDoubleDown:j,dealersTurn:p}}),K={key:0,class:"flex flex-col items-center"},M={class:"m-0 mt-1"},G=P({__name:"BlackjackHand",props:{player:{}},setup(n){const e=n,t=f(()=>e.player.cards),a=f(()=>`${t.value.length*5.5}rem`);return(u,h)=>t.value.length?(r(),i("div",K,[o("div",{class:"flex content-center",style:H({maxWidth:a.value})},[(r(!0),i(b,null,N(t.value,(d,B)=>(r(),i("div",{key:d.id,class:$(["overflow-hidden",{"overflow-visible":B===t.value.length-1}])},[D(W,{card:d,class:"w-36"},null,8,["card"])],2))),128))],4),o("p",M,[L(" Total: "),o("span",null,C(u.player.currentScore),1)])])):k("",!0)}}),Q={key:0,class:"flex flex-col justify-center items-center"},q={key:0},X={class:"text-center"},Z=o("hr",{class:"divider"},null,-1),ee={class:"flex justify-between"},te={key:0},ae={class:"mt-4 flex flex-col items-center"},se=o("div",{class:"text-primary mb-4"},"Your turn",-1),ne={class:"flex justify-center join join-horizontal"},re=["onClick"],le=["onClick"],ce=["onClick"],ie={class:"text-center"},oe={key:1,class:"flex items-center justify-center my-8"},ue=P({__name:"BlackjackGame",setup(n){const e=J(),{players:t,dealer:a,activePlayerIndex:u,isDealersTurn:h,isGameOver:d,isGameInProgress:B,isGameInit:w}=Y(e);function x(m){if(m.isBusted)return{msg:"Busted!",className:"text-error"};if(d)return a.value.finalScore===m.finalScore?{msg:"Push",className:"text-primary"}:!a.value.isBusted&&a.value.finalScore>m.finalScore?{msg:"You lost!",className:"text-error"}:{msg:m.hasBlackjack?"Winner winner chicken dinner!":a.value.isBusted?"Dealer Busted, You Won!":"You Won!",className:"text-success"}}return(m,_)=>(r(),i(b,null,[c(B)||c(d)?(r(),i("section",Q,[c(a).cards.length?(r(),i("div",q,[o("h3",X,C(c(a).name),1),D(G,{player:c(a)},null,8,["player"])])):k("",!0),Z,o("div",ee,[(r(!0),i(b,null,N(c(t),(l,y)=>{var j,p;return r(),i("div",{key:l.name},[l.cards.length?(r(),i("div",te,[D(G,{player:l},null,8,["player"]),o("div",ae,[y===c(u)?(r(),i(b,{key:0},[se,o("div",ne,[o("button",{type:"button",class:"join-item btn btn-primary",onClick:s=>c(e).playerHit(l)}," Hit ",8,re),o("button",{type:"button",class:"join-item btn btn-outline text-primary",onClick:s=>c(e).playerStand(l)}," Stay ",8,le),l.cards.length===2?(r(),i("button",{key:0,type:"button",class:"join-item btn btn-outline text-primary",onClick:s=>c(e).playerDoubleDown(l)}," Double Down ",8,ce)):k("",!0)])],64)):(r(),i("div",{key:1,class:$((j=x(l))==null?void 0:j.className)},C((p=x(l))==null?void 0:p.msg),3))]),o("h3",ie,C(l.name),1)])):k("",!0)])}),128))])])):k("",!0),c(d)||c(w)?(r(),i("div",oe,[o("button",{type:"button",class:"btn btn-accent",onClick:_[0]||(_[0]=(...l)=>c(e).startGame&&c(e).startGame(...l))}," Start New Game ")])):k("",!0)],64))}}),de={key:0},fe=P({__name:"BlackjackView",setup(n){const e=S("init"),t=f(()=>e.value==="loading"),a=f(()=>e.value==="loaded");return z(()=>{e.value="loading",setTimeout(()=>{e.value="loaded"},500)}),(u,h)=>t.value?(r(),i("div",de,"Loading...")):a.value?(r(),A(ue,{key:1})):k("",!0)}});export{fe as default};
