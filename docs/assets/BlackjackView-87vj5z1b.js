var F=Object.defineProperty;var N=(s,e,t)=>e in s?F(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var v=(s,e,t)=>N(s,typeof e!="symbol"?e+"":e,t);import{d as V,r as m,D as P,c as k,a as D,o as c,b as l,e as o,F as S,f as G,n as H,g,_ as L,h as R,i as W,t as C,j as _,s as z,u as i,k as A,l as O}from"./index-DtTdh5Su.js";class U{constructor(e){v(this,"playerType","player");v(this,"name","");v(this,"cards",[]);v(this,"id","");this.name=e.name,this.id=e.name,this.playerType=e.playerType??"player",this.cards=e.cards??[]}get isDealer(){return this.playerType==="dealer"}}class $ extends U{constructor(){super(...arguments);v(this,"finalScore",0);v(this,"currentScore",0);v(this,"hasBlackjack",!1);v(this,"isBusted",!1)}playerReset(){this.cards=[],this.finalScore=0,this.currentScore=0,this.hasBlackjack=!1,this.isBusted=!1}calculateCurrentState(){this.currentScore=this.getPlayerScore(),this.isBusted=this.currentScore>21,this.hasBlackjack=this.cards.length===2&&this.currentScore===21,(this.isBusted||this.hasBlackjack)&&(this.finalScore=this.currentScore)}addCard(t){this.cards.push(t),this.calculateCurrentState(),(this.isBusted||this.hasBlackjack)&&this.stand()}stand(){this.cards.forEach(t=>t.setFaceUp()),this.calculateCurrentState(),this.finalScore=this.currentScore}getPlayerScore(){return[...this.cards].sort((a,u)=>a.isAce?1:-1).reduce((a,u)=>{let d=0;return u.rank==="A"?a+11>21?d=1:d=11:["K","Q","J"].includes(u.rank)?d=10:d=parseInt(u.rank),a+d},0)}}class J extends ${constructor(){super({name:"Dealer",playerType:"dealer",cards:[]})}}const K=V("blackjack",()=>{const s=m(new J),e=m([new $({name:"Brian"})]),t=m(-1),a=m(new P),u=k(()=>t.value>e.value.length-1),d=k(()=>t.value>-1?e.value[t.value]:void 0),h=m("init"),y=k(()=>h.value==="over"),B=k(()=>h.value==="inProgress"),w=k(()=>h.value==="init");function x(){t.value=-1,h.value="inProgress",a.value=new P,a.value.shuffle(),s.value.playerReset(),e.value.forEach(n=>n.playerReset());for(let n=0;n<2;n++){e.value.forEach(E=>E.addCard(a.value.dealCard()));const p=a.value.dealCard();n===0&&p.setFaceDown(),s.value.addCard(p)}r(),s.value.hasBlackjack&&(e.value.forEach(n=>f(n)),b())}function r(){var n,p;t.value++,u.value?b():((n=d.value)!=null&&n.hasBlackjack||(p=d.value)!=null&&p.isBusted)&&r()}function j(n){n.addCard(a.value.dealCard()),(n.isBusted||n.hasBlackjack)&&f(n)}function f(n){n.stand(),r()}function I(n){n.addCard(a.value.dealCard()),f(n)}function b(){for(console.log("dealer turn"),s.value.cards.forEach(n=>n.setFaceUp()),s.value.calculateCurrentState();s.value.currentScore<17;)s.value.addCard(a.value.dealCard());s.value.stand(),h.value="over"}return{dealer:s,players:e,activePlayerIndex:t,deck:a,isDealersTurn:u,isGameOver:y,isGameInProgress:B,isGameInit:w,startGame:x,playerHit:j,playerStand:f,playerDoubleDown:I,dealersTurn:b}}),M={key:0,class:"flex flex-col items-center"},Q={class:"m-0 mt-1"},T=D({__name:"BlackjackHand",props:{player:{}},setup(s){const e=s,t=k(()=>e.player.cards),a=k(()=>`${t.value.length*5.5}rem`);return(u,d)=>t.value.length?(c(),l("div",M,[o("div",{class:"flex content-center",style:R({maxWidth:a.value})},[(c(!0),l(S,null,G(t.value,(h,y)=>(c(),l("div",{key:h.id,class:H(["overflow-hidden",{"overflow-visible":y===t.value.length-1}])},[g(L,{card:h,class:"w-36"},null,8,["card"])],2))),128))],4),o("p",Q,[W(" Total: "),o("span",null,C(u.player.currentScore),1)])])):_("",!0)}}),Y={key:0,class:"flex flex-col justify-center items-center"},q={key:0},X={class:"text-center"},Z=o("hr",{class:"divider"},null,-1),ee={class:"flex justify-between"},te={key:0},ae={class:"mt-4 flex flex-col items-center"},se=o("div",{class:"text-primary mb-4"},"Your turn",-1),ne={class:"flex justify-center join join-horizontal"},ce=["onClick"],re=["onClick"],le=["onClick"],ie={key:1,class:"text-error"},oe={key:2,class:"text-primary"},ue={key:3,class:"text-error"},de=o("div",{class:"text-success"},"Winner!",-1),he={key:0,class:"text-accent"},ve={class:"text-center"},ke={key:1,class:"flex items-center justify-center my-8"},_e=D({__name:"BlackjackGame",setup(s){const e=K(),{players:t,dealer:a,activePlayerIndex:u,isDealersTurn:d,isGameOver:h,isGameInProgress:y,isGameInit:B}=z(e);return(w,x)=>(c(),l(S,null,[i(y)||i(h)?(c(),l("section",Y,[i(a).cards.length?(c(),l("div",q,[o("h3",X,C(i(a).name),1),g(T,{player:i(a)},null,8,["player"])])):_("",!0),Z,o("div",ee,[(c(!0),l(S,null,G(i(t),(r,j)=>(c(),l("div",{key:r.name},[r.cards.length?(c(),l("div",te,[g(T,{player:r},null,8,["player"]),o("div",ae,[j===i(u)?(c(),l(S,{key:0},[se,o("div",ne,[o("button",{type:"button",class:"join-item btn btn-primary",onClick:f=>i(e).playerHit(r)}," Hit ",8,ce),o("button",{type:"button",class:"join-item btn btn-outline text-primary",onClick:f=>i(e).playerStand(r)}," Stay ",8,re),r.cards.length===2?(c(),l("button",{key:0,type:"button",class:"join-item btn btn-outline text-primary",onClick:f=>i(e).playerDoubleDown(r)}," Double Down ",8,le)):_("",!0)])],64)):r.isBusted?(c(),l("div",ie,"Busted!")):i(a).finalScore===r.finalScore?(c(),l("div",oe,"Push")):!i(a).isBusted&&i(a).finalScore>r.finalScore?(c(),l("div",ue,"Dealer Wins!")):(c(),l(S,{key:4},[de,r.hasBlackjack?(c(),l("div",he,"Blackjack!")):_("",!0)],64))]),o("h3",ve,C(r.name),1)])):_("",!0)]))),128))])])):_("",!0),i(h)||i(B)?(c(),l("div",ke,[o("button",{type:"button",class:"btn btn-accent",onClick:x[0]||(x[0]=(...r)=>i(e).startGame&&i(e).startGame(...r))}," Start New Game ")])):_("",!0)],64))}}),fe={key:0},pe=D({__name:"BlackjackView",setup(s){const e=m("init"),t=k(()=>e.value==="loading"),a=k(()=>e.value==="loaded");return A(()=>{e.value="loading",setTimeout(()=>{e.value="loaded"},500)}),(u,d)=>t.value?(c(),l("div",fe,"Loading...")):a.value?(c(),O(_e,{key:1})):_("",!0)}});export{pe as default};
