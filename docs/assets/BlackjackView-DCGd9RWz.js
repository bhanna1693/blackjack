var F=Object.defineProperty;var R=(r,e,t)=>e in r?F(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var v=(r,e,t)=>R(r,typeof e!="symbol"?e+"":e,t);import{d as V,r as p,c as m,u as W,D as H,a as T,o as l,b as c,e as d,F as b,f as I,n as N,g as P,_ as L,h as Y,i as z,t as j,j as k,s as A,k as i,l as O,m as U}from"./index-DbaVdDnY.js";class J{constructor(e){v(this,"playerType","player");v(this,"name","");v(this,"cards",[]);v(this,"id","");v(this,"isDealer");this.name=e.name,this.id=e.name,this.playerType=e.playerType??"player",this.cards=e.cards??[],this.isDealer=this.playerType==="dealer"}}class $ extends J{constructor(){super(...arguments);v(this,"finalScore",0);v(this,"currentScore",0);v(this,"hasBlackjack",!1);v(this,"isBusted",!1)}playerReset(){this.cards=[],this.finalScore=0,this.currentScore=0,this.hasBlackjack=!1,this.isBusted=!1}calculateCurrentState(){this.currentScore=this.getPlayerScore(),this.isBusted=this.currentScore>21,this.hasBlackjack=this.cards.length===2&&this.currentScore===21,(this.isBusted||this.hasBlackjack)&&(this.finalScore=this.currentScore)}addCard(t){this.cards.push(t),this.calculateCurrentState(),(this.isBusted||this.hasBlackjack)&&this.stand()}stand(){this.cards.forEach(t=>t.setFaceUp()),this.calculateCurrentState(),this.finalScore=this.currentScore}getPlayerScore(){return[...this.cards].sort((a,o)=>a.isAce?1:-1).reduce((a,o)=>{let h=0;return o.rank==="A"?a+11>21?h=1:h=11:["K","Q","J"].includes(o.rank)?h=10:h=parseInt(o.rank),a+h},0)}}class K extends ${constructor(){super({name:"Dealer",playerType:"dealer",cards:[]})}}const M=V("blackjack",()=>{const r=p(new K),e=p([new $({name:"Brian"})]),t=p(-1),a=p(f()),o=m(()=>t.value>e.value.length-1),h=m(()=>t.value>-1?e.value[t.value]:void 0),u=p("init"),S=m(()=>u.value==="over"),D=m(()=>u.value==="inProgress"),B=m(()=>u.value==="init");function f(){const s=W();return new H({backImgChoice:s.selectedCardImage})}function x(){t.value=-1,u.value="inProgress",a.value=f(),a.value.shuffle(),r.value.playerReset(),e.value.forEach(s=>s.playerReset());for(let s=0;s<2;s++){e.value.forEach(E=>E.addCard(a.value.dealCard()));const g=a.value.dealCard();s===0&&g.setFaceDown(),r.value.addCard(g)}n(),r.value.hasBlackjack&&(e.value.forEach(s=>y(s)),_())}function n(){var s,g;t.value++,o.value?_():((s=h.value)!=null&&s.hasBlackjack||(g=h.value)!=null&&g.isBusted)&&n()}function w(s){s.addCard(a.value.dealCard()),(s.isBusted||s.hasBlackjack)&&y(s)}function y(s){s.stand(),n()}function C(s){s.addCard(a.value.dealCard()),y(s)}function _(){for(console.log("dealer turn"),r.value.cards.forEach(s=>s.setFaceUp()),r.value.calculateCurrentState();r.value.currentScore<17;)r.value.addCard(a.value.dealCard());r.value.stand(),u.value="over"}return{dealer:r,players:e,activePlayerIndex:t,deck:a,isDealersTurn:o,isGameOver:S,isGameInProgress:D,isGameInit:B,startGame:x,playerHit:w,playerStand:y,playerDoubleDown:C,dealersTurn:_}}),Q={key:0,class:"flex flex-col items-center"},q={key:0,class:"m-0 mt-1"},G=T({__name:"BlackjackHand",props:{player:{}},setup(r){const e=r,t=m(()=>e.player.cards),a=m(()=>`${t.value.length*5.5}rem`);return(o,h)=>t.value.length?(l(),c("div",Q,[d("div",{class:"flex content-center",style:Y({maxWidth:a.value})},[(l(!0),c(b,null,I(t.value,(u,S)=>(l(),c("div",{key:u.id,class:N(["overflow-hidden",{"overflow-visible":S===t.value.length-1}])},[P(L,{card:u,class:"w-36"},null,8,["card"])],2))),128))],4),o.player.isDealer?k("",!0):(l(),c("p",q,[z(" Total: "),d("span",null,j(o.player.currentScore),1)]))])):k("",!0)}}),X={key:0,class:"flex flex-col justify-center items-center"},Z={key:0},ee={class:"text-center"},te=d("hr",{class:"divider"},null,-1),ae={class:"flex justify-between"},se={key:0},re={class:"mt-4 flex flex-col items-center"},ne=d("div",{class:"text-primary mb-4"},"Your turn",-1),le={class:"flex justify-center join join-horizontal"},ce=["onClick"],ie=["onClick"],oe=["onClick"],ue={class:"text-center"},de={key:1,class:"flex items-center justify-center my-8"},he=T({__name:"BlackjackGame",setup(r){const e=M(),{players:t,dealer:a,activePlayerIndex:o,isDealersTurn:h,isGameOver:u,isGameInProgress:S,isGameInit:D}=A(e);function B(f){if(f.isBusted)return{msg:"Busted!",className:"text-error"};if(u)return a.value.finalScore===f.finalScore?{msg:"Push",className:"text-primary"}:!a.value.isBusted&&a.value.finalScore>f.finalScore?{msg:"You lost!",className:"text-error"}:{msg:f.hasBlackjack?"Winner winner chicken dinner!":a.value.isBusted?"Dealer Busted, You Won!":"You Won!",className:"text-success"}}return(f,x)=>(l(),c(b,null,[i(S)||i(u)?(l(),c("section",X,[i(a).cards.length?(l(),c("div",Z,[d("h3",ee,j(i(a).name),1),P(G,{player:i(a)},null,8,["player"])])):k("",!0),te,d("div",ae,[(l(!0),c(b,null,I(i(t),(n,w)=>{var y,C;return l(),c("div",{key:n.name},[n.cards.length?(l(),c("div",se,[P(G,{player:n},null,8,["player"]),d("div",re,[w===i(o)?(l(),c(b,{key:0},[ne,d("div",le,[d("button",{type:"button",class:"join-item btn btn-primary",onClick:_=>i(e).playerHit(n)}," Hit ",8,ce),d("button",{type:"button",class:"join-item btn btn-outline text-primary",onClick:_=>i(e).playerStand(n)}," Stay ",8,ie),n.cards.length===2?(l(),c("button",{key:0,type:"button",class:"join-item btn btn-outline text-primary",onClick:_=>i(e).playerDoubleDown(n)}," Double Down ",8,oe)):k("",!0)])],64)):(l(),c("div",{key:1,class:N((y=B(n))==null?void 0:y.className)},j((C=B(n))==null?void 0:C.msg),3))]),d("h3",ue,j(n.name),1)])):k("",!0)])}),128))])])):k("",!0),i(u)||i(D)?(l(),c("div",de,[d("button",{type:"button",class:"btn btn-accent",onClick:x[0]||(x[0]=(...n)=>i(e).startGame&&i(e).startGame(...n))}," Start New Game ")])):k("",!0)],64))}}),ve={key:0},ke=T({__name:"BlackjackView",setup(r){const e=p("init"),t=m(()=>e.value==="loading"),a=m(()=>e.value==="loaded");return O(()=>{e.value="loading",setTimeout(()=>{e.value="loaded"},500)}),(o,h)=>t.value?(l(),c("div",ve,"Loading...")):a.value?(l(),U(he,{key:1})):k("",!0)}});export{ke as default};
