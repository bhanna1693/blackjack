var F=Object.defineProperty;var R=(s,e,t)=>e in s?F(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var v=(s,e,t)=>R(s,typeof e!="symbol"?e+"":e,t);import{d as V,r as S,c as m,u as W,D as H,a as T,o as i,b as u,e as d,F as j,f as I,n as N,g as P,_ as L,h as Y,i as z,t as D,j as y,s as A,k as o,l as O,m as U}from"./index-kk-6gXic.js";class J{constructor(e){v(this,"playerType","player");v(this,"name","");v(this,"cards",[]);v(this,"id","");v(this,"isDealer");this.name=e.name,this.id=e.name,this.playerType=e.playerType??"player",this.cards=e.cards??[],this.isDealer=this.playerType==="dealer"}}class $ extends J{constructor(){super(...arguments);v(this,"finalScore",0);v(this,"currentScore",0);v(this,"hasBlackjack",!1);v(this,"isBusted",!1)}playerReset(){this.cards=[],this.finalScore=0,this.currentScore=0,this.hasBlackjack=!1,this.isBusted=!1}calculateCurrentState(){this.currentScore=this.getPlayerScore(this.cards),this.isBusted=this.currentScore>21,this.hasBlackjack=this.cards.length===2&&this.currentScore===21,(this.isBusted||this.hasBlackjack)&&(this.finalScore=this.currentScore)}addCard(t){this.cards.push(t),this.calculateCurrentState(),(this.isBusted||this.hasBlackjack)&&this.stand()}stand(){this.cards.forEach(t=>t.setFaceUp()),this.calculateCurrentState(),this.finalScore=this.currentScore}getPlayerScore(t){return[...t].sort((h,n)=>h.isAce?1:-1).reduce((h,n)=>{let c=0;return n.rank==="A"?h+11>21?c=1:c=11:["K","Q","J"].includes(n.rank)?c=10:c=parseInt(n.rank),h+c},0)}}class K extends ${constructor(){super({name:"Dealer",playerType:"dealer",cards:[]})}}const M=V("blackjack",()=>{const s=S(new K),e=S([new $({name:"Brian"})]),t=S(-1),r=S(f()),h=m(()=>t.value>e.value.length-1),n=m(()=>t.value>-1?e.value[t.value]:void 0),c=S("init"),_=m(()=>c.value==="over"),g=m(()=>c.value==="inProgress"),x=m(()=>c.value==="init");function f(){const a=W();return new H({backImgChoice:a.selectedCardImage})}function C(){t.value=-1,c.value="inProgress",r.value=f(),r.value.shuffle(),s.value.playerReset(),e.value.forEach(a=>a.playerReset());for(let a=0;a<2;a++){e.value.forEach(E=>E.addCard(r.value.dealCard()));const B=r.value.dealCard();a===0&&B.setFaceDown(),s.value.addCard(B)}l(),s.value.hasBlackjack&&(e.value.forEach(a=>k(a)),p())}function l(){var a,B;t.value++,h.value?p():((a=n.value)!=null&&a.hasBlackjack||(B=n.value)!=null&&B.isBusted)&&l()}function w(a){a.addCard(r.value.dealCard()),(a.isBusted||a.hasBlackjack)&&k(a)}function k(a){a.stand(),l()}function b(a){a.addCard(r.value.dealCard()),k(a)}function p(){for(console.log("dealer turn"),s.value.cards.forEach(a=>a.setFaceUp()),s.value.calculateCurrentState();s.value.currentScore<17;)s.value.addCard(r.value.dealCard());s.value.stand(),c.value="over"}return{dealer:s,players:e,activePlayerIndex:t,deck:r,isDealersTurn:h,isGameOver:_,isGameInProgress:g,isGameInit:x,startGame:C,playerHit:w,playerStand:k,playerDoubleDown:b,dealersTurn:p}}),Q={key:0,class:"flex flex-col items-center"},q={class:"m-0 mt-1"},G=T({__name:"BlackjackHand",props:{player:{}},setup(s){const e=s,t=m(()=>e.player.cards),r=m(()=>`${t.value.length*5.5}rem`),h=m(()=>{const n=e.player;return n.isDealer&&n.finalScore===0?n.getPlayerScore(n.cards.slice(1)):n.currentScore});return(n,c)=>t.value.length?(i(),u("div",Q,[d("div",{class:"flex content-center",style:Y({maxWidth:r.value})},[(i(!0),u(j,null,I(t.value,(_,g)=>(i(),u("div",{key:_.id,class:N(["overflow-hidden",{"overflow-visible":g===t.value.length-1}])},[P(L,{card:_,class:"w-36"},null,8,["card"])],2))),128))],4),d("p",q,[z(" Total: "),d("span",null,D(h.value),1)])])):y("",!0)}}),X={key:0,class:"flex flex-col justify-center items-center"},Z={key:0},ee={class:"text-center"},te=d("hr",{class:"divider"},null,-1),ae={class:"flex justify-between"},se={key:0},re={class:"mt-4 flex flex-col items-center"},ne=d("div",{class:"text-primary mb-4"},"Your turn",-1),ce={class:"flex justify-center join join-horizontal"},le=["onClick"],ie=["onClick"],oe=["onClick"],ue={class:"text-center"},de={key:1,class:"flex items-center justify-center my-8"},he=T({__name:"BlackjackGame",setup(s){const e=M(),{players:t,dealer:r,activePlayerIndex:h,isDealersTurn:n,isGameOver:c,isGameInProgress:_,isGameInit:g}=A(e);function x(f){if(f.isBusted)return{msg:"Busted!",className:"text-error"};if(c)return r.value.finalScore===f.finalScore?{msg:"Push",className:"text-primary"}:!r.value.isBusted&&r.value.finalScore>f.finalScore?{msg:"You lost!",className:"text-error"}:{msg:f.hasBlackjack?"Winner winner chicken dinner!":r.value.isBusted?"Dealer Busted, You Won!":"You Won!",className:"text-success"}}return(f,C)=>(i(),u(j,null,[o(_)||o(c)?(i(),u("section",X,[o(r).cards.length?(i(),u("div",Z,[d("h3",ee,D(o(r).name),1),P(G,{player:o(r)},null,8,["player"])])):y("",!0),te,d("div",ae,[(i(!0),u(j,null,I(o(t),(l,w)=>{var k,b;return i(),u("div",{key:l.name},[l.cards.length?(i(),u("div",se,[P(G,{player:l},null,8,["player"]),d("div",re,[w===o(h)?(i(),u(j,{key:0},[ne,d("div",ce,[d("button",{type:"button",class:"join-item btn btn-primary",onClick:p=>o(e).playerHit(l)}," Hit ",8,le),d("button",{type:"button",class:"join-item btn btn-outline text-primary",onClick:p=>o(e).playerStand(l)}," Stay ",8,ie),l.cards.length===2?(i(),u("button",{key:0,type:"button",class:"join-item btn btn-outline text-primary",onClick:p=>o(e).playerDoubleDown(l)}," Double Down ",8,oe)):y("",!0)])],64)):(i(),u("div",{key:1,class:N((k=x(l))==null?void 0:k.className)},D((b=x(l))==null?void 0:b.msg),3))]),d("h3",ue,D(l.name),1)])):y("",!0)])}),128))])])):y("",!0),o(c)||o(g)?(i(),u("div",de,[d("button",{type:"button",class:"btn btn-accent",onClick:C[0]||(C[0]=(...l)=>o(e).startGame&&o(e).startGame(...l))}," Start New Game ")])):y("",!0)],64))}}),ve={key:0},ke=T({__name:"BlackjackView",setup(s){const e=S("init"),t=m(()=>e.value==="loading"),r=m(()=>e.value==="loaded");return O(()=>{e.value="loading",setTimeout(()=>{e.value="loaded"},500)}),(h,n)=>t.value?(i(),u("div",ve,"Loading...")):r.value?(i(),U(he,{key:1})):y("",!0)}});export{ke as default};
