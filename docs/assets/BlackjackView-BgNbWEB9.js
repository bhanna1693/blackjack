var E=Object.defineProperty;var F=(a,e,t)=>e in a?E(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var v=(a,e,t)=>F(a,typeof e!="symbol"?e+"":e,t);import{d as N,r as f,D as T,c as k,a as P,o as r,b as n,e as o,F as S,f as G,n as V,g as C,_ as H,h as L,i as R,t as b,j as _,s as W,u as l,k as z,l as A}from"./index-BbJ2y9gG.js";class O{constructor(e){v(this,"playerType","player");v(this,"name","");v(this,"cards",[]);v(this,"id","");this.name=e.name,this.id=e.name,this.playerType=e.playerType??"player",this.cards=e.cards??[]}get isDealer(){return this.playerType==="dealer"}}class $ extends O{constructor(){super(...arguments);v(this,"finalScore",0);v(this,"currentScore",0);v(this,"hasBlackjack",!1);v(this,"isBusted",!1)}playerReset(){this.cards=[],this.finalScore=0,this.currentScore=0,this.hasBlackjack=!1,this.isBusted=!1}calculateCurrentState(){this.currentScore=this.getPlayerScore(),this.isBusted=this.currentScore>21,this.hasBlackjack=this.cards.length===2&&this.currentScore===21,(this.isBusted||this.hasBlackjack)&&(this.finalScore=this.currentScore)}addCard(t){this.cards.push(t),this.calculateCurrentState(),(this.isBusted||this.hasBlackjack)&&this.stand()}stand(){this.cards.forEach(t=>t.setFaceUp()),this.calculateCurrentState(),this.finalScore=this.currentScore}getPlayerScore(){return[...this.cards].sort((s,d)=>s.isAce?1:-1).reduce((s,d)=>{let u=0;return d.rank==="A"?s+11>21?u=1:u=11:["K","Q","J"].includes(d.rank)?u=10:u=parseInt(d.rank),s+u},0)}}class U extends ${constructor(){super({name:"Dealer",playerType:"dealer",cards:[]})}}const J=N("blackjack",()=>{const a=f(new U),e=f([new $({name:"Brian"})]),t=f(-1),s=f(new T),d=k(()=>t.value>e.value.length-1),u=k(()=>t.value>-1?e.value[t.value]:void 0),h=f("init"),m=k(()=>h.value==="over"),B=k(()=>h.value==="inProgress"),w=k(()=>h.value==="init");function x(){t.value=-1,h.value="inProgress",s.value=new T,s.value.shuffle(),a.value.playerReset(),e.value.forEach(c=>c.playerReset());for(let c=0;c<2;c++){e.value.forEach(I=>I.addCard(s.value.dealCard()));const p=s.value.dealCard();c===0&&p.setFaceDown(),a.value.addCard(p)}i(),a.value.hasBlackjack&&(e.value.forEach(c=>y(c)),g())}function i(){var c,p;t.value++,d.value?g():((c=u.value)!=null&&c.hasBlackjack||(p=u.value)!=null&&p.isBusted)&&i()}function j(c){c.addCard(s.value.dealCard()),(c.isBusted||c.hasBlackjack)&&y(c)}function y(c){c.stand(),i()}function g(){for(console.log("dealer turn"),a.value.cards.forEach(c=>c.setFaceUp()),a.value.calculateCurrentState();a.value.currentScore<17;)a.value.addCard(s.value.dealCard());a.value.stand(),h.value="over"}return{dealer:a,players:e,activePlayerIndex:t,deck:s,isDealersTurn:d,isGameOver:m,isGameInProgress:B,isGameInit:w,startGame:x,playerHit:j,playerStand:y,dealersTurn:g}}),K={key:0,class:"flex flex-col items-center"},M={class:"m-0 mt-1"},D=P({__name:"BlackjackHand",props:{player:{}},setup(a){const e=a,t=k(()=>e.player.cards),s=k(()=>`${t.value.length*5.5}rem`);return(d,u)=>t.value.length?(r(),n("div",K,[o("div",{class:"flex content-center",style:L({maxWidth:s.value})},[(r(!0),n(S,null,G(t.value,(h,m)=>(r(),n("div",{key:h.id,class:V(["overflow-hidden",{"overflow-visible":m===t.value.length-1}])},[C(H,{card:h,class:"w-36"},null,8,["card"])],2))),128))],4),o("p",M,[R(" Total: "),o("span",null,b(d.player.currentScore),1)])])):_("",!0)}}),Q={key:0,class:"flex flex-col justify-center items-center"},Y={key:0},q={class:"text-center"},X={key:0,class:"mt-4 flex flex-col items-center"},Z={key:0,class:"text-error"},ee=o("hr",{class:"divider"},null,-1),te={class:"flex justify-between"},se={key:0},ae={class:"mt-4 flex flex-col items-center"},re=o("div",{class:"text-primary mb-4"},"Your turn",-1),ce={class:"flex justify-center join join-horizontal"},ne=["onClick"],le=["onClick"],ie={key:1,class:"text-error"},oe={key:2,class:"text-primary"},de={key:3,class:"text-error"},ue=o("div",{class:"text-success"},"Winner!",-1),he={key:0,class:"text-accent"},ve={class:"text-center"},_e={key:1,class:"flex items-center justify-center my-8"},ke=P({__name:"BlackjackGame",setup(a){const e=J(),{players:t,dealer:s,activePlayerIndex:d,isDealersTurn:u,isGameOver:h,isGameInProgress:m,isGameInit:B}=W(e);return(w,x)=>(r(),n(S,null,[l(m)||l(h)?(r(),n("section",Q,[l(s).cards.length?(r(),n("div",Y,[o("h3",q,b(l(s).name),1),C(D,{player:l(s)},null,8,["player"]),l(u)?(r(),n("div",X,[l(s).isBusted?(r(),n("div",Z,"Dealer Busted!")):_("",!0)])):_("",!0)])):_("",!0),ee,o("div",te,[(r(!0),n(S,null,G(l(t),(i,j)=>(r(),n("div",{key:i.name},[i.cards.length?(r(),n("div",se,[C(D,{player:i},null,8,["player"]),o("div",ae,[j===l(d)?(r(),n(S,{key:0},[re,o("div",ce,[o("button",{type:"button",class:"join-item btn btn-primary",onClick:y=>l(e).playerHit(i)}," Hit ",8,ne),o("button",{type:"button",class:"join-item btn btn-outline text-primary",onClick:y=>l(e).playerStand(i)}," Stay ",8,le)])],64)):i.isBusted?(r(),n("div",ie,"Busted!")):l(s).finalScore===i.finalScore?(r(),n("div",oe,"Push")):!l(s).isBusted&&l(s).finalScore>i.finalScore?(r(),n("div",de,"Dealer Wins!")):(r(),n(S,{key:4},[ue,i.hasBlackjack?(r(),n("div",he,"Blackjack!")):_("",!0)],64))]),o("h3",ve,b(i.name),1)])):_("",!0)]))),128))])])):_("",!0),l(h)||l(B)?(r(),n("div",_e,[o("button",{type:"button",class:"btn btn-accent",onClick:x[0]||(x[0]=(...i)=>l(e).startGame&&l(e).startGame(...i))}," Start New Game ")])):_("",!0)],64))}}),fe={key:0},pe=P({__name:"BlackjackView",setup(a){const e=f("init"),t=k(()=>e.value==="loading"),s=k(()=>e.value==="loaded");return z(()=>{e.value="loading",setTimeout(()=>{e.value="loaded"},500)}),(d,u)=>t.value?(r(),n("div",fe,"Loading...")):s.value?(r(),A(ke,{key:1})):_("",!0)}});export{pe as default};
